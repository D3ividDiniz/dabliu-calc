<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora Financeira Pro</title>
    <style>
        /* 1. Reset e Configura√ß√µes Globais */
        :root {
            --font-main: 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            
            /* Light Theme (Padr√£o) */
            --bg-color-light: #F4F6F9;
            --surface-color-light: #FFFFFF;
            --text-color-light: #121212;
            --text-muted-light: #555;
            --border-color-light: #E0E0E0;

            /* Dark Theme */
            --bg-color-dark: #121212;
            --surface-color-dark: #1E1E1E;
            --text-color-dark: #E0E0E0;
            --text-muted-dark: #888;
            --border-color-dark: #333;

            /* Cor de Destaque */
            --accent-color: #FFB700; /* Laranja-amarelado vibrante */
            --accent-text-color: #000;
        }

        body {
            font-family: var(--font-main);
            margin: 0;
            transition: background-color 0.3s, color 0.3s;
        }

        /* Aplica as vari√°veis do tema */
        body {
            background-color: var(--bg-color-light);
            color: var(--text-color-light);
        }

        body.dark-mode {
            background-color: var(--bg-color-dark);
            color: var(--text-color-dark);
        }

        /* 2. Layout Principal */
        .app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            max-width: 1400px;
            margin: 0 auto;
        }

        .main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }
        
        .calculator {
            flex: 2;
            padding: 20px;
            display: flex;
            flex-direction: column;
            border-right: 1px solid var(--border-color-light);
        }
        body.dark-mode .calculator {
            border-right-color: var(--border-color-dark);
        }

        /* 3. Header e Controles */
        .app-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            background-color: var(--surface-color-light);
            border-bottom: 1px solid var(--border-color-light);
        }
        body.dark-mode .app-header {
            background-color: var(--surface-color-dark);
            border-bottom-color: var(--border-color-dark);
        }

        .app-header h1 {
            font-size: 1.5em;
            margin: 0;
        }
        
        .controls {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        /* Theme Toggle Switch */
        .theme-switch-wrapper {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .theme-switch {
            display: inline-block;
            height: 24px;
            position: relative;
            width: 44px;
        }
        .theme-switch input { display: none; }
        .slider {
            background-color: #ccc;
            bottom: 0;
            cursor: pointer;
            left: 0;
            position: absolute;
            right: 0;
            top: 0;
            transition: .4s;
            border-radius: 24px;
        }
        .slider:before {
            background-color: #fff;
            bottom: 4px;
            content: "";
            height: 16px;
            left: 4px;
            position: absolute;
            transition: .4s;
            width: 16px;
            border-radius: 50%;
        }
        input:checked + .slider {
            background-color: var(--accent-color);
        }
        input:checked + .slider:before {
            transform: translateX(20px);
        }
        
        /* 4. Display da Calculadora */
        .display {
            background-color: var(--bg-color-light);
            border: 1px solid var(--border-color-light);
            border-radius: 8px;
            padding: 15px;
            text-align: right;
            margin-bottom: 20px;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
        }
        body.dark-mode .display {
            background-color: #000;
            border-color: #444;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .display-main {
            font-size: 2.5em;
            font-weight: bold;
            min-height: 50px;
            word-wrap: break-word;
        }
        .display-context {
            font-size: 0.9em;
            color: var(--text-muted-light);
            min-height: 20px;
        }
        body.dark-mode .display-context {
            color: var(--text-muted-dark);
        }

        /* 5. Se√ß√µes e Bot√µes da Calculadora */
        .button-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(70px, 1fr));
            gap: 10px;
        }

        .calc-button {
            padding: 18px 10px;
            font-size: 1.1em;
            border-radius: 6px;
            border: 1px solid var(--border-color-light);
            background-color: var(--surface-color-light);
            color: var(--text-color-light);
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
        }
        body.dark-mode .calc-button {
            border-color: var(--border-color-dark);
            background-color: var(--surface-color-dark);
            color: var(--text-color-dark);
        }

        .calc-button:hover {
            filter: brightness(95%);
        }
        body.dark-mode .calc-button:hover {
            filter: brightness(120%);
        }
        .calc-button:active {
            transform: scale(0.97);
        }

        .btn-function { background-color: #e8e8e8; }
        body.dark-mode .btn-function { background-color: #2a2a2a; }

        .btn-accent {
            background-color: var(--accent-color);
            color: var(--accent-text-color);
            font-weight: bold;
        }
        
        .btn-clear { background-color: #f5c5c5; }
        body.dark-mode .btn-clear { background-color: #582828; }
        
        /* 6. Painel de Hist√≥rico (Novo Requisito Chave) */
        .history-panel {
            flex: 1;
            padding: 20px;
            display: flex;
            flex-direction: column;
            background-color: var(--surface-color-light);
            overflow-y: auto;
        }
        body.dark-mode .history-panel {
            background-color: var(--surface-color-dark);
        }

        .history-header {
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border-color-light);
            padding-bottom: 15px;
        }
        body.dark-mode .history-header {
            border-bottom-color: var(--border-color-dark);
        }

        .history-header h2 {
            margin: 0 0 15px 0;
        }

        .history-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        #history-search {
            flex-grow: 1;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid var(--border-color-light);
            background-color: var(--bg-color-light);
            color: var(--text-color-light);
        }
        body.dark-mode #history-search {
            border-color: var(--border-color-dark);
            background-color: #333;
            color: var(--text-color-dark);
        }
        
        #clear-history {
            padding: 10px 15px;
            border: 1px solid #ff9999;
            background-color: #ffe0e0;
            color: #c53030;
            border-radius: 5px;
            cursor: pointer;
        }
        body.dark-mode #clear-history {
            background-color: #4d2020;
            border-color: #c53030;
            color: #ff9999;
        }

        #history-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .history-group-title {
            margin-top: 20px;
            margin-bottom: 10px;
            font-weight: bold;
            color: var(--text-muted-light);
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        body.dark-mode .history-group-title {
            color: var(--text-muted-dark);
        }

        .history-card {
            background-color: var(--bg-color-light);
            border: 1px solid var(--border-color-light);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 12px;
            transition: box-shadow 0.2s;
        }
        .history-card:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
        }
        body.dark-mode .history-card {
            background-color: #2c2c2c;
            border-color: var(--border-color-dark);
        }
        body.dark-mode .history-card:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .history-card-title {
            font-weight: bold;
            margin: 0 0 10px 0;
        }

        .history-card-details {
            font-size: 0.9em;
            color: var(--text-muted-light);
            margin-bottom: 10px;
            word-wrap: break-word;
        }
        body.dark-mode .history-card-details {
            color: var(--text-muted-dark);
        }
        
        .history-card-result {
            font-size: 1.2em;
            font-weight: bold;
            color: var(--accent-color);
            margin-bottom: 15px;
        }

        .history-card-actions {
            display: flex;
            gap: 10px;
        }

        .history-action-btn {
            background: none;
            border: 1px solid var(--border-color-light);
            color: var(--text-muted-light);
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8em;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        body.dark-mode .history-action-btn {
            border-color: #555;
            color: var(--text-muted-dark);
        }
        .history-action-btn:hover {
            border-color: var(--accent-color);
            color: var(--accent-color);
        }

        /* 7. Responsividade */
        @media (max-width: 900px) {
            .main-content {
                flex-direction: column;
            }
            .calculator {
                border-right: none;
                border-bottom: 1px solid var(--border-color-light);
            }
            body.dark-mode .calculator {
                border-bottom-color: var(--border-color-dark);
            }
            .history-panel {
                height: 40vh;
            }
        }
        
        @media (max-width: 480px) {
            .app-header h1 {
                font-size: 1.2em;
            }
            .controls {
                gap: 10px;
            }
            .display-main {
                font-size: 2em;
            }
            .button-grid {
                gap: 8px;
                grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
            }
            .calc-button {
                padding: 15px 8px;
                font-size: 1em;
            }
        }

    </style>
</head>
<body>

    <div class="app-container">
        <header class="app-header">
            <h1>Calculadora Financeira Pro</h1>
            <div class="controls">
                <div class="theme-switch-wrapper">
                    <span>‚òÄÔ∏è</span>
                    <label class="theme-switch">
                        <input type="checkbox" id="theme-toggle">
                        <span class="slider"></span>
                    </label>
                    <span>üåô</span>
                </div>
            </div>
        </header>

        <main class="main-content">
            <section class="calculator">
                <div class="display">
                    <div class="display-context" id="display-context">n, i, PV, PMT, FV</div>
                    <div class="display-main" id="display-main">0</div>
                </div>

                <div class="button-grid">
                    <button class="calc-button btn-function" data-key="n">n</button>
                    <button class="calc-button btn-function" data-key="i">i</button>
                    <button class="calc-button btn-function" data-key="PV">PV</button>
                    <button class="calc-button btn-function" data-key="PMT">PMT</button>
                    <button class="calc-button btn-function" data-key="FV">FV</button>
                    
                    <button class="calc-button" data-key="/">√∑</button>
                    <button class="calc-button" data-key="*">√ó</button>
                    <button class="calc-button" data-key="-">‚àí</button>
                    <button class="calc-button" data-key="+">+</button>

                    <button class="calc-button" data-key="7">7</button>
                    <button class="calc-button" data-key="8">8</button>
                    <button class="calc-button" data-key="9">9</button>
                    <button class="calc-button" data-key="Enter">=</button>
                    
                    <button class="calc-button" data-key="4">4</button>
                    <button class="calc-button" data-key="5">5</button>
                    <button class="calc-button" data-key="6">6</button>

                    <button class="calc-button" data-key="1">1</button>
                    <button class="calc-button" data-key="2">2</button>
                    <button class="calc-button" data-key="3">3</button>

                    <button class="calc-button" data-key="0">0</button>
                    <button class="calc-button" data-key=".">.</button>
                    <button class="calc-button" data-key="CHS">+/-</button>
                    
                    <button class="calc-button btn-clear" data-key="C">C</button>
                    <button class="calc-button btn-clear" data-key="AC">AC</button>
                    <button class="calc-button btn-accent" data-key="COMPUTE">COMPUTE</button>
                </div>
            </section>

            <section class="history-panel">
                <div class="history-header">
                    <h2>Hist√≥rico de C√°lculos</h2>
                    <div class="history-controls">
                        <input type="search" id="history-search" placeholder="Buscar no hist√≥rico...">
                        <button id="clear-history" title="Limpar todo o hist√≥rico">üóëÔ∏è Limpar Tudo</button>
                    </div>
                </div>
                <ul id="history-list">
                    </ul>
            </section>
        </main>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // Mapeamento de elementos do DOM
        const dom = {
            displayMain: document.getElementById('display-main'),
            displayContext: document.getElementById('display-context'),
            themeToggle: document.getElementById('theme-toggle'),
            historyList: document.getElementById('history-list'),
            clearHistoryBtn: document.getElementById('clear-history'),
            historySearch: document.getElementById('history-search'),
            buttons: document.querySelectorAll('.calc-button'),
        };

        // Estado da Calculadora
        let state = {
            currentValue: '0',
            previousValue: null,
            operator: null,
            isNewEntry: true,
            registers: { n: null, i: null, PV: null, PMT: null, FV: null },
            history: [],
            lastComputedKey: null,
        };
        
        // --- M√ìDULO DE TEMA ---
        const themeManager = (() => {
            const body = document.body;
            
            const applyTheme = (theme) => {
                if (theme === 'dark') {
                    body.classList.add('dark-mode');
                    dom.themeToggle.checked = true;
                } else {
                    body.classList.remove('dark-mode');
                    dom.themeToggle.checked = false;
                }
            };

            const toggleTheme = () => {
                const newTheme = body.classList.contains('dark-mode') ? 'light' : 'dark';
                applyTheme(newTheme);
                localStorage.setItem('calculatorTheme', newTheme);
            };

            const loadTheme = () => {
                const savedTheme = localStorage.getItem('calculatorTheme') || 'light';
                applyTheme(savedTheme);
            };

            return { init: loadTheme, toggle: toggleTheme };
        })();
        
        // --- M√ìDULO DE HIST√ìRICO ---
        const historyManager = (() => {
            const load = () => {
                const savedHistory = localStorage.getItem('calculatorHistory');
                state.history = savedHistory ? JSON.parse(savedHistory) : [];
                render();
            };

            const save = () => {
                localStorage.setItem('calculatorHistory', JSON.stringify(state.history));
            };

            const add = (entry) => {
                entry.id = Date.now();
                state.history.unshift(entry); // Adiciona no in√≠cio
                save();
                render();
            };
            
            const clear = () => {
                if (confirm('Voc√™ tem certeza que deseja apagar todo o hist√≥rico? Esta a√ß√£o n√£o pode ser desfeita.')) {
                    state.history = [];
                    save();
                    render();
                }
            };

            const deleteItem = (id) => {
                state.history = state.history.filter(item => item.id !== id);
                save();
                render();
            };
            
            const reuse = (id) => {
                const entry = state.history.find(item => item.id === id);
                if (!entry || !entry.type.startsWith('TVM')) return;
                
                Object.keys(entry.inputs).forEach(key => {
                    state.registers[key] = entry.inputs[key];
                });
                state.lastComputedKey = entry.computed;
                updateDisplay.context();
                alert(`Dados do c√°lculo "${entry.title}" carregados. Pressione COMPUTE para recalcular "${entry.computed}".`);
            };
            
            const copyResult = (text) => {
                navigator.clipboard.writeText(text).then(() => {
                    alert('Resultado copiado para a √°rea de transfer√™ncia!');
                }, () => {
                    alert('Falha ao copiar o resultado.');
                });
            };

            const formatTemporalGroup = (date) => {
                const today = new Date();
                const yesterday = new Date(today);
                yesterday.setDate(yesterday.getDate() - 1);
                
                today.setHours(0, 0, 0, 0);
                yesterday.setHours(0, 0, 0, 0);
                date.setHours(0, 0, 0, 0);

                if (date.getTime() === today.getTime()) return "Hoje";
                if (date.getTime() === yesterday.getTime()) return "Ontem";
                
                const lastWeek = new Date(today);
                lastWeek.setDate(today.getDate() - 7);
                if(date > lastWeek) return "Na √∫ltima semana";
                
                return date.toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' });
            };

            const render = (filter = '') => {
                dom.historyList.innerHTML = '';
                const filteredHistory = state.history.filter(item => 
                    JSON.stringify(item).toLowerCase().includes(filter.toLowerCase())
                );
                
                if (filteredHistory.length === 0) {
                    dom.historyList.innerHTML = '<li>Nenhum registro encontrado.</li>';
                    return;
                }

                const grouped = {};
                filteredHistory.forEach(item => {
                    const group = formatTemporalGroup(new Date(item.id));
                    if (!grouped[group]) grouped[group] = [];
                    grouped[group].push(item);
                });

                for (const groupName in grouped) {
                    const groupTitle = document.createElement('h3');
                    groupTitle.className = 'history-group-title';
                    groupTitle.textContent = groupName;
                    dom.historyList.appendChild(groupTitle);
                    
                    grouped[groupName].forEach(item => {
                        const card = document.createElement('li');
                        card.className = 'history-card';
                        card.innerHTML = `
                            <h4 class="history-card-title">${item.title}</h4>
                            <p class="history-card-details">${item.inputsFormatted}</p>
                            <p class="history-card-result">${item.resultFormatted}</p>
                            <div class="history-card-actions">
                                ${item.type.startsWith('TVM') ? `<button class="history-action-btn reuse-btn" data-id="${item.id}">üîÑ Reutilizar</button>` : ''}
                                <button class="history-action-btn copy-btn" data-result="${item.result}">üìã Copiar</button>
                                <button class="history-action-btn delete-btn" data-id="${item.id}">üóëÔ∏è Excluir</button>
                            </div>
                        `;
                        dom.historyList.appendChild(card);
                    });
                }
            };
            
            const bindEvents = () => {
                dom.clearHistoryBtn.addEventListener('click', clear);
                dom.historySearch.addEventListener('input', (e) => render(e.target.value));
                dom.historyList.addEventListener('click', (e) => {
                    const target = e.target.closest('.history-action-btn');
                    if (!target) return;
                    
                    const id = Number(target.dataset.id);
                    if (target.classList.contains('reuse-btn')) reuse(id);
                    if (target.classList.contains('delete-btn')) deleteItem(id);
                    if (target.classList.contains('copy-btn')) copyResult(target.dataset.result);
                });
            };

            return { init: () => { load(); bindEvents(); }, add };
        })();
        
        // --- M√ìDULO DE C√ÅLCULO FINANCEIRO ---
        const financialEngine = {
            // TVM: n, i, PV, PMT, FV
            // i √© a taxa por per√≠odo
            solveTVM: (solveFor, { n, i, PV, PMT, FV }) => {
                i = i / 100; // Converte para decimal
                if (i === 0) { // Caso especial sem juros
                     switch (solveFor) {
                        case 'PV': return -(FV + PMT * n);
                        case 'FV': return -(PV + PMT * n);
                        case 'PMT': return -(PV + FV) / n;
                        case 'n': return -(PV + FV) / PMT;
                        default: return null;
                     }
                }
                
                const factor = Math.pow(1 + i, n);
                
                switch (solveFor) {
                    case 'FV':
                        return -(PV * factor + PMT * (factor - 1) / i);
                    case 'PV':
                        return -(FV / factor + PMT * (1 - Math.pow(1 + i, -n)) / i);
                    case 'PMT':
                        return -(PV * factor + FV) / ((factor - 1) / i);
                    case 'n':
                        // Logaritmo para resolver n
                        const pvPlusPmtOverI = PV + PMT / i;
                        if (pvPlusPmtOverI === 0 || (FV + PMT / i) / pvPlusPmtOverI <= 0) return null; // Imposs√≠vel
                        return Math.log(-(FV + PMT / i) / (PV + PMT / i)) / Math.log(1 + i);
                    case 'i':
                         // N√£o h√° f√≥rmula direta, precisa de m√©todo num√©rico (simplificado aqui)
                         // Para uma calculadora real, seria necess√°rio Newton-Raphson
                         return null; // A ser implementado se necess√°rio
                }
                return null;
            }
        };

        // --- M√ìDULO DE ATUALIZA√á√ÉO DO DISPLAY ---
        const updateDisplay = {
            main: (value = state.currentValue) => {
                // Formata para exibi√ß√£o com separador de milhar
                const [integerPart, decimalPart] = String(value).split('.');
                const formattedInteger = parseFloat(integerPart).toLocaleString('pt-BR');
                dom.displayMain.textContent = decimalPart !== undefined ? `${formattedInteger},${decimalPart}` : formattedInteger;
            },
            context: () => {
                let contextStr = '';
                ['n', 'i', 'PV', 'PMT', 'FV'].forEach(key => {
                    const value = state.registers[key];
                    if (value !== null) {
                        contextStr += `<span style="font-weight: ${key === state.lastComputedKey ? 'bold; color: var(--accent-color);' : 'normal'};">${key}: ${value}</span> | `;
                    } else {
                         contextStr += `<span style="opacity: 0.5;">${key}</span> | `;
                    }
                });
                dom.displayContext.innerHTML = contextStr.slice(0, -3);
            }
        };

        // --- L√ìGICA PRINCIPAL DA CALCULADORA ---
        const handleInput = (key, type) => {
            if (/\d/.test(key)) handleNumber(key);
            else if (key === '.') handleDecimal();
            else if (['n', 'i', 'PV', 'PMT', 'FV'].includes(key)) handleRegister(key);
            else if (['+', '-', '*', '/'].includes(key)) handleOperator(key);
            else if (key === 'Enter') handleEquals();
            else if (key === 'COMPUTE') handleCompute();
            else if (key === 'CHS') toggleSign();
            else if (key === 'C') clearEntry();
            else if (key === 'AC') allClear();
        };

        const handleNumber = (number) => {
            if (state.isNewEntry) {
                state.currentValue = number;
                state.isNewEntry = false;
            } else {
                if(state.currentValue === '0') state.currentValue = number;
                else state.currentValue += number;
            }
            updateDisplay.main();
        };

        const handleDecimal = () => {
            if (state.isNewEntry) {
                state.currentValue = '0.';
                state.isNewEntry = false;
            } else if (!state.currentValue.includes('.')) {
                state.currentValue += '.';
            }
            updateDisplay.main();
        };

        const toggleSign = () => {
            if (state.currentValue !== '0') {
                state.currentValue = String(parseFloat(state.currentValue) * -1);
                updateDisplay.main();
            }
        };

        const clearEntry = () => {
            state.currentValue = '0';
            state.isNewEntry = true;
            updateDisplay.main();
        };
        
        const allClear = () => {
            state.currentValue = '0';
            state.previousValue = null;
            state.operator = null;
            state.isNewEntry = true;
            state.registers = { n: null, i: null, PV: null, PMT: null, FV: null };
            state.lastComputedKey = null;
            updateDisplay.main();
            updateDisplay.context();
        };
        
        const handleRegister = (key) => {
            const value = parseFloat(state.currentValue);
            if (!isNaN(value)) {
                state.registers[key] = value;
                state.isNewEntry = true;
                updateDisplay.context();
            }
        };

        const handleOperator = (op) => {
            if (!state.isNewEntry) {
                if (state.previousValue !== null && state.operator) {
                    handleEquals();
                }
                state.previousValue = parseFloat(state.currentValue);
                state.isNewEntry = true;
            }
            state.operator = op;
        };
        
        const handleEquals = () => {
            if (!state.operator || state.previousValue === null) return;
            
            const current = parseFloat(state.currentValue);
            let result;
            switch(state.operator) {
                case '+': result = state.previousValue + current; break;
                case '-': result = state.previousValue - current; break;
                case '*': result = state.previousValue * current; break;
                case '/': result = state.previousValue / current; break;
            }
            
            state.currentValue = String(result);
            state.operator = null;
            state.previousValue = null;
            updateDisplay.main();
        };

        const handleCompute = () => {
            const keys = ['n', 'i', 'PV', 'PMT', 'FV'];
            const nullKeys = keys.filter(k => state.registers[k] === null);
            
            if (nullKeys.length !== 1) {
                alert('Para calcular uma vari√°vel TVM, exatamente 4 das 5 devem ser preenchidas.');
                return;
            }
            
            const solveFor = nullKeys[0];
            const result = financialEngine.solveTVM(solveFor, state.registers);
            
            if (result === null || isNaN(result)) {
                alert(`N√£o foi poss√≠vel calcular ${solveFor}. Verifique os valores de entrada.`);
                return;
            }

            state.registers[solveFor] = parseFloat(result.toFixed(4));
            state.lastComputedKey = solveFor;
            state.currentValue = String(state.registers[solveFor]);
            
            updateDisplay.main();
            updateDisplay.context();
            
            // Adicionar ao hist√≥rico
            const inputsFormatted = keys.filter(k => k !== solveFor).map(k => `${k}: ${state.registers[k]}`).join(', ');
            historyManager.add({
                type: 'TVM',
                title: `TVM - C√°lculo de ${solveFor}`,
                inputs: { ...state.registers },
                computed: solveFor,
                inputsFormatted: `Entradas: ${inputsFormatted}`,
                result: state.registers[solveFor],
                resultFormatted: `Resultado (${solveFor}): ${state.registers[solveFor].toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`
            });
        };

        // --- INICIALIZA√á√ÉO ---
        const init = () => {
            themeManager.init();
            historyManager.init();
            updateDisplay.main();
            updateDisplay.context();

            dom.themeToggle.addEventListener('change', themeManager.toggle);
            dom.buttons.forEach(button => {
                button.addEventListener('click', () => {
                    handleInput(button.dataset.key);
                });
            });
        };

        init(); // Inicia a aplica√ß√£o
    });
    </script>
</body>
</html>
